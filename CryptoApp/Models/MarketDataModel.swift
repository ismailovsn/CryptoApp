//
//  MarketDataModel.swift
//  CryptoApp
//
//  Created by Саид-Насир Исмаилов on 2023/06/07.
//

import Foundation

// JSON data:
/*
 URL: https://api.coingecko.com/api/v3/global
 
 JSON Response:
 {
   "data": {
     "active_cryptocurrencies": 10011,
     "upcoming_icos": 0,
     "ongoing_icos": 49,
     "ended_icos": 3376,
     "markets": 751,
     "total_market_cap": {
       "btc": 43548775.86849382,
       "eth": 622624105.2040167,
       "ltc": 12943179774.561304,
       "bch": 10298159309.88245,
       "bnb": 4204804217.8413,
       "eos": 1320573993146.6602,
       "xrp": 2196883751322.2046,
       "xlm": 13141927753466.953,
       "link": 188491647084.3794,
       "dot": 226189675866.49057,
       "yfi": 191219834.75222328,
       "usd": 1168931686835.365,
       "aed": 4293468551770.988,
       "ars": 284280176802674.44,
       "aud": 1752873848857.3433,
       "bdt": 126117977781404.14,
       "bhd": 440658022644.76245,
       "bmd": 1168931686835.365,
       "brl": 5743428950096.879,
       "cad": 1568742560615.3477,
       "chf": 1061117610563.478,
       "clp": 927723561388644.9,
       "cny": 8330391666232.227,
       "czk": 25845572885101.74,
       "dkk": 8156067714842.755,
       "eur": 1094824924685.0619,
       "gbp": 942224399763.7667,
       "hkd": 9165042789651.58,
       "huf": 403668645255191.3,
       "idr": 17398807715132396,
       "ils": 4287833132108.7544,
       "inr": 96471935621317.77,
       "jpy": 162770100716764.16,
       "krw": 1523434757913223.8,
       "kwd": 359755091667.19855,
       "lkr": 341834626636391.2,
       "mmk": 2453996685324824,
       "mxn": 20315354736820.254,
       "myr": 5383514883720.261,
       "ngn": 543998598520058,
       "nok": 12997027631845.164,
       "nzd": 1927073893487.9805,
       "php": 65647786829585.6,
       "pkr": 334537567074526.44,
       "pln": 4906339435178.777,
       "rub": 95267456721885.72,
       "sar": 4384545864150.7705,
       "sek": 12775494036419.484,
       "sgd": 1576963657168.8608,
       "thb": 40662457658254.94,
       "try": 26553545712687.074,
       "twd": 35921856371225.805,
       "uah": 43159307430652.16,
       "vef": 117045129802.82497,
       "vnd": 27452601017555132,
       "zar": 22522280227590.12,
       "xdr": 875893371194.2941,
       "xag": 49794958558.67665,
       "xau": 597078616.3186334,
       "bits": 43548775868493.82,
       "sats": 4354877586849382
     },
     "total_volume": {
       "btc": 2015584.1034416168,
       "eth": 28817141.78736985,
       "ltc": 599053977.553172,
       "bch": 476633516.9187904,
       "bnb": 194612509.08998987,
       "eos": 61120614642.36252,
       "xrp": 101679183351.68967,
       "xlm": 608252703783.3435,
       "link": 8724028630.381395,
       "dot": 10468820442.067646,
       "yfi": 8850298.349445757,
       "usd": 54102097682.59196,
       "aed": 198716193256.6948,
       "ars": 13157444586211.291,
       "aud": 81128908784.12604,
       "bdt": 5837165020252.797,
       "bhd": 20395138273.895138,
       "bmd": 54102097682.59196,
       "brl": 265825246753.6472,
       "cad": 72606692255.06638,
       "chf": 49112098907.03342,
       "clp": 42938172782854.58,
       "cny": 385558599134.99146,
       "czk": 1196220210847.3289,
       "dkk": 377490299205.4876,
       "eur": 50672186995.80861,
       "gbp": 43609320449.639336,
       "hkd": 424189065841.1942,
       "huf": 18683145236759.945,
       "idr": 805275453789032.2,
       "ils": 198455367043.767,
       "inr": 4465046284050.608,
       "jpy": 7533548784723.801,
       "krw": 70509694461970.23,
       "kwd": 16650677991.185198,
       "lkr": 15821258478879.031,
       "mmk": 113579236389456.89,
       "mxn": 940263078506.791,
       "myr": 249167210877.17664,
       "ngn": 25178088375724.3,
       "nok": 601546237851.6815,
       "nzd": 89191473891.27417,
       "php": 3038400802801.097,
       "pkr": 15483525971789.16,
       "pln": 227081923071.6781,
       "rub": 4409298941577.488,
       "sar": 202931558197.63416,
       "sek": 591292916503.0714,
       "sgd": 72987192308.06805,
       "thb": 1881995569986.6406,
       "try": 1228987579125.5723,
       "twd": 1662584566936.9868,
       "uah": 1997558191657.6343,
       "vef": 5417243040.957927,
       "vnd": 1270598888386688.2,
       "zar": 1042407027400.0596,
       "xdr": 40539296916.640656,
       "xag": 2304678487.5304465,
       "xau": 27634810.47529102,
       "bits": 2015584103441.6167,
       "sats": 201558410344161.7
     },
     "market_cap_percentage": {
       "btc": 44.53655639747734,
       "eth": 19.310560869516102,
       "usdt": 7.111472640090651,
       "bnb": 3.754894926711041,
       "usdc": 2.448255802248718,
       "xrp": 2.365478835871002,
       "steth": 1.1418791475659555,
       "ada": 1.0313055898269319,
       "doge": 0.8317471980931949,
       "sol": 0.6831573412110157
     },
     "market_cap_change_percentage_24h_usd": 2.9405638500160687,
     "updated_at": 1686121368
   }
 }
 
 */

struct GlobalData: Codable {
    let data: MarketDataModel?
}

struct MarketDataModel: Codable {
    let totalMarketCap, totalVolume, marketCapPercentage: [String: Double]
    let marketCapChangePercentage24HUsd: Double
    
    enum CodingKeys: String, CodingKey {
        case totalMarketCap = "total_market_cap"
        case totalVolume = "total_volume"
        case marketCapPercentage = "market_cap_percentage"
        case marketCapChangePercentage24HUsd = "market_cap_change_percentage_24h_usd"
    }
    
    var marketCap: String {
        if let item = totalMarketCap.first(where: { $0.key == "usd" }) {
            return "\(item.value)"
        }
        return ""
    }
    
    var volume: String {
        if let item = totalVolume.first(where: { $0.key == "usd" }) {
            return "\(item.value)"
        }
        return ""
    }
    
    var btcDominance: String {
        if let item = marketCapPercentage.first(where: { $0.key == "btc" }) {
            return "\(item.value.asPercentString())"
        }
        return ""
    }
}
